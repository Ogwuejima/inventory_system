{% extends 'base.html' %}
{% block title %}Manage Users{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Manage Users</h4>
        </div>
        <div class="card-body">
            <a href="{% url 'add_user' %}" class="btn btn-success mb-3">
                <i class="fas fa-user-plus"></i> Add User
            </a>

            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Admin</th>
                        <th>Last Active</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.first_name }}</td>
                        <td>{{ user.last_name }}</td>
                        <td>{{ user.is_staff|yesno:"Yes,No" }}</td>
                        <td> {% if user.last_login %}
                          {{ user.last_login|timesince }} ago
                          {% else %}
                          Never
                          {% endif %}
                         </td>

                        <td>
                            <a href="{% url 'edit_user' user.id %}" class="btn btn-primary btn-sm">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button class="btn btn-danger btn-sm"
                                    data-bs-toggle="modal"
                                    data-bs-target="#deleteModal"
                                    data-username="{{ user.username }}"
                                    data-delete-url="{% url 'delete_user' user.id %}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="6" class="text-center">No users found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete <strong id="modal-username"></strong>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a href="#" class="btn btn-danger" id="confirm-delete-btn">Delete</a>
      </div>
    </div>
  </div>
</div>

<!-- Modal Script -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const deleteModal = document.getElementById('deleteModal');
  deleteModal.addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    const username = button.getAttribute('data-username');
    const deleteUrl = button.getAttribute('data-delete-url');

    // Set modal username and URL
    document.getElementById('modal-username').textContent = username;
    document.getElementById('confirm-delete-btn').setAttribute('href', deleteUrl);
  });
});
</script>
{% endblock %}
